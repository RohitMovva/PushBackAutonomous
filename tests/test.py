import matplotlib.pyplot as plt
import matplotlib.animation as animation
import numpy as np
import matplotlib.patches as patches
import math

def calculate_angle(p1, p2):
    """Calculate angle between two points in degrees"""
    dx = p2[0] - p1[0]
    dy = p2[1] - p1[1]
    return math.degrees(math.atan2(dy, dx))

def animate_coordinates(coords1, coords2, robot_size=1.5, interval=25):
    """
    Animate two lists of coordinates with a specified interval between points.
    Includes a rotating square robot representation following the second path.
    Uses a fixed grid size of [-6, 6] x [-6, 6].
    
    Args:
        coords1: List of tuples [(x1, y1), (x2, y2), ...]
        coords2: List of tuples [(x1, y1), (x2, y2), ...]
        robot_size: Size of the robot square in plot units (default: 1.5)
        interval: Time between frames in milliseconds (default: 20)
    """
    # Convert coordinate lists to numpy arrays for easier handling
    coords1 = np.array(coords1)
    coords2 = np.array(coords2)
    
    # Calculate angles for each segment of path2
    angles = np.zeros(len(coords2))
    for i in range(len(coords2)-1):
        angles[i] = calculate_angle(coords2[i], coords2[i+1])
    # Set the last angle same as the previous one
    angles[-1] = angles[-2] if len(angles) > 1 else 0
    
    # Set up the figure and axis
    fig, ax = plt.subplots()
    
    # Initialize empty line objects
    line1, = ax.plot([], [], 'b-', label='Goal')
    line2, = ax.plot([], [], 'r-', label='Robot')
    
    # Create robot square patch
    robot = patches.Rectangle((0, 0), robot_size, robot_size, 
                            facecolor='gray', alpha=0.5, 
                            edgecolor='black', zorder=3,
                            rotation_point='center')
    ax.add_patch(robot)
    
    # Set fixed plot limits
    ax.set_xlim(-6, 6)
    ax.set_ylim(-6, 6)
    
    # Add legend
    ax.legend()
    
    # Add grid
    ax.grid(True)
    
    # Set aspect ratio to equal for perfect squares
    ax.set_aspect('equal')
    
    def init():
        """Initialize animation"""
        line1.set_data([], [])
        line2.set_data([], [])
        robot.set_xy((0, 0))
        return line1, line2, robot

    def animate(frame):
        """Animation function called for each frame"""
        # Update data for both lines up to the current frame
        line1.set_data(coords1[:frame+1, 0], coords1[:frame+1, 1])
        line2.set_data(coords2[:frame+1, 0], coords2[:frame+1, 1])
        
        # Update robot position and rotation
        if frame < len(coords2):
            # Center the robot on the current point
            robot_x = coords2[frame, 0] - robot_size/2
            robot_y = coords2[frame, 1] - robot_size/2
            
            # Update position and angle
            robot.set_xy((robot_x, robot_y))
            
            # Get the current angle
            current_angle = angles[frame]
            
            # Remove old robot and add new rotated one
            robot.set_angle(current_angle)
        
        return line1, line2, robot
    
    # Create animation
    frames = min(len(coords1), len(coords2))
    anim = animation.FuncAnimation(fig, animate, init_func=init,
                                 frames=frames, interval=interval,
                                 blit=True)
    
    plt.show()

# Example usage:
if __name__ == "__main__":
    # Example coordinate lists
    coords1 = [(2.76199,-3.88724), (2.76199,-3.88724), (2.7369,-3.88043), (2.7369,-3.88043), (2.7369,-3.88043), (2.7369,-3.88043), (2.7369,-3.88043), (2.68697,-3.86682), (2.68697,-3.86682), (2.68697,-3.86682), (2.63736,-3.85321), (2.63736,-3.85321), (2.58807,-3.8396), (2.5391,-3.826), (2.5391,-3.826), (2.49044,-3.81241), (2.44211,-3.79882), (2.39409,-3.78523), (2.3464,-3.77165), (2.29902,-3.75808), (2.25196,-3.74451), (2.20522,-3.73094), (2.1588,-3.71738), (2.06692,-3.69028), (2.02146,-3.67673), (1.93149,-3.64966), (1.88699,-3.63613), (1.79894,-3.60908), (1.75539,-3.59557), (1.66926,-3.56855), (1.5844,-3.54156), (1.50082,-3.51458), (1.41851,-3.48763), (1.33748,-3.46069), (1.23799,-3.42705), (1.15984,-3.40016), (1.08296,-3.37329), (0.970038,-3.33303), (0.896352,-3.30621), (0.788218,-3.26602), (0.682956,-3.22587), (0.580568,-3.18577), (0.481052,-3.14571), (0.38441,-3.1057), (0.29064,-3.06574), (0.214693,-3.03247), (0.126191,-2.99258), (0.0405614,-2.95274), (-0.0421951,-2.91295), (-0.122079,-2.8732), (-0.173738,-2.84673), (-0.248833,-2.80706), (-0.321056,-2.76743), (-0.390405,-2.72785), (-0.456881,-2.68831), (-0.499602,-2.66198), (-0.571292,-2.61595), (-0.610502,-2.58967), (-0.666923,-2.55029), (-0.702941,-2.52406), (-0.754573,-2.48476), (-0.787399,-2.45858), (-0.834243,-2.41935), (-0.863877,-2.39323), (-0.892233,-2.36712), (-0.919313,-2.34103), (-0.945115,-2.31496), (-0.969641,-2.28892), (-0.99289,-2.26289), (-1.01486,-2.23688), (-1.0305,-2.21739), (-1.04519,-2.19649), (-1.05984,-2.17049), (-1.07285,-2.14182), (-1.08435,-2.11071), (-1.09631,-2.07047), (-1.1049,-2.03479), (-1.1144,-1.98592), (-1.12057,-1.9467), (-1.12687,-1.89812), (-1.13215,-1.84829), (-1.1373,-1.78909), (-1.1414,-1.73364), (-1.14537,-1.67402), (-1.14922,-1.61511), (-1.15327,-1.55757), (-1.15751,-1.50591), (-1.16289,-1.45281), (-1.16844,-1.40985), (-1.17627,-1.36329), (-1.1859,-1.32117), (-1.19149,-1.30197), (-1.20568,-1.26201), (-1.22504,-1.21596), (-1.24457,-1.17428), (-1.27027,-1.1234), (-1.29646,-1.07431), (-1.32219,-1.02768), (-1.35359,-0.972012), (-1.38594,-0.91534), (-1.41863,-0.858041), (-1.4488,-0.804606), (-1.47605,-0.755354), (-1.50235,-0.706417), (-1.52735,-0.658032), (-1.55065,-0.610438), (-1.57357,-0.560048), (-1.58927,-0.522298), (-1.60555,-0.478373), (-1.61674,-0.443076), (-1.627,-0.402494), (-1.63344,-0.364073), (-1.63379,-0.360977), (-1.6374,-0.31706), (-1.63913,-0.271296), (-1.63925,-0.221607), (-1.63774,-0.168659), (-1.63484,-0.11716), (-1.63009,-0.0598155), (-1.62361,-0.00116843), (-1.61538,0.0581131), (-1.6069,0.108925), (-1.59622,0.163455), (-1.58496,0.212865), (-1.57453,0.253048), (-1.56314,0.29207), (-1.54819,0.337022), (-1.53605,0.369156), (-1.52162,0.403033), (-1.50935,0.428592), (-1.4931,0.458408), (-1.47936,0.480403), (-1.46496,0.500612), (-1.44602,0.52317), (-1.43214,0.537054), (-1.40835,0.558333), (-1.37484,0.586167), (-1.33936,0.613385), (-1.30197,0.639985), (-1.26274,0.665963), (-1.22171,0.691318), (-1.17897,0.716048), (-1.13455,0.74015), (-1.08854,0.763623), (-1.01666,0.797647), (-0.966914,0.819536), (-0.915785,0.840787), (-0.836632,0.871465), (-0.782313,0.891114), (-0.712779,0.914768), (-0.627099,0.941817), (-0.539174,0.967401), (-0.479413,0.98364), (-0.388211,1.00677), (-0.295319,1.02841), (-0.200949,1.04856), (-0.105307,1.06721), (-0.00860407,1.08436), (0.0889524,1.09999), (0.187153,1.11411), (0.302257,1.12864), (0.401137,1.13943), (0.500001,1.14868), (0.598639,1.15637), (0.696842,1.16251), (0.794403,1.16708), (0.891111,1.17008), (0.986758,1.1715), (1.08114,1.17133), (1.17403,1.16956), (1.26525,1.16619), (1.33982,1.16215), (1.42739,1.15583), (1.51269,1.14788), (1.56819,1.14167), (1.64922,1.131), (1.72742,1.11868), (1.77788,1.10955), (1.85088,1.09448), (1.89769,1.08351), (1.96493,1.06566), (2.00769,1.05283), (2.05871,1.03575), (2.00149,1.05874), (1.93581,1.09133), (1.88639,1.11995), (1.8203,1.16335), (1.75404,1.21238), (1.70427,1.2526), (1.63784,1.31049), (1.588,1.35689), (1.51324,1.43086), (1.46344,1.48285), (1.39713,1.55514), (1.33097,1.63047), (1.28147,1.68871), (1.21568,1.76836), (1.15017,1.84994), (1.085,1.93302), (1.01213,2.02779), (0.94782,2.11273), (0.899904,2.17661), (0.836476,2.26171), (0.773619,2.34633), (0.726881,2.40925), (0.680512,2.4715), (0.619299,2.55317), (0.573875,2.6132), (0.521436,2.68167), (0.476989,2.73881), (0.433026,2.79434), (0.389568,2.84809), (0.332445,2.91669), (0.290246,2.96563), (0.248621,3.01221), (0.207591,3.05628), (0.167177,3.09765), (0.127399,3.13615), (0.0947516,3.16593), (0.0380954,3.2119), (-0.00477976,3.24269), (-0.0677712,3.28393), (-0.136843,3.32542), (-0.192258,3.35672), (-0.270456,3.39871), (-0.353003,3.44101), (-0.41739,3.47297), (-0.4948,3.51052), (-0.585773,3.5538), (-0.655396,3.58653), (-0.749579,3.63057), (-0.84473,3.67506), (-0.91635,3.70876), (-0.987897,3.74275), (-1.08272,3.78853), (-1.15306,3.82323), (-1.21095,3.8524), (-1.27933,3.88771), (-1.34627,3.92337), (-1.41149,3.95939), (-1.47474,3.99578), (-1.53574,4.03255), (-1.57504,4.05728), (-1.63171,4.09471), (-1.66788,4.1199), (-1.71949,4.15802), (-1.75204,4.18368), (-1.79785,4.22253), (-1.83311,4.25525), (-1.8593,4.28166), (-1.88361,4.30827), (-1.90596,4.33509), (-1.92627,4.36213), (-1.94446,4.38939), (-1.96046,4.41687), (-1.97419,4.44457), (-1.98556,4.4725), (-1.9945,4.50066), (-2.00092,4.52906), (-2.00477,4.55769), (-2.00594,4.58657), (-2.00437,4.61569), (-1.99997,4.64506), (-1.99477,4.66725), (-1.98375,4.6992), (-1.96655,4.73247), (-1.94413,4.76339), (-1.91033,4.79741), (-1.87643,4.82318), (-1.83731,4.8466), (-1.78825,4.86966), (-1.73816,4.88816), (-1.68286,4.90432), (-1.62234,4.91813), (-1.5566,4.9296), (-1.50024,4.93709), (-1.43286,4.94372), (-1.35302,4.94886), (-1.2854,4.95128), (-1.21443,4.95221), (-1.14013,4.95163), (-1.06248,4.94955), (-1.00205,4.94701), (-0.939747,4.94362), (-0.875562,4.93939), (-0.82064,4.93522), (-0.775762,4.93147), (-0.73005,4.92733), (-0.659915,4.92043), (-0.612114,4.91536), (-0.587901,4.91269), (-0.538848,4.90705), (-0.514008,4.90409), (-0.463702,4.8979), (-0.438236,4.89466), (-0.412562,4.89133), (-0.386678,4.8879), (-0.360586,4.88438), (-0.334285,4.88077), (-0.307775,4.87706), (-0.307775,4.87706), (-0.281056,4.87326), (-0.281056,4.87326), (-0.281056,4.87326), (-0.254129,4.86937), (-0.254129,4.86937)]
    coords2 = [(2.76199,-3.88724), (2.75926,-3.88651), (2.75369,-3.88499), (2.74538,-3.88273), (2.73438,-3.87975), (2.72077,-3.87605), (2.70465,-3.87166), (2.68524,-3.86639), (2.66347,-3.86043), (2.63946,-3.85386), (2.61215,-3.84639), (2.58287,-3.83833), (2.55033,-3.82937), (2.51454,-3.81946), (2.47729,-3.80908), (2.43691,-3.79782), (2.39356,-3.78566), (2.34733,-3.7726), (2.29834,-3.75868), (2.24673,-3.74391), (2.19264,-3.72833), (2.13624,-3.71198), (2.07769,-3.69489), (2.01471,-3.67638), (1.95005,-3.65711), (1.88125,-3.63647), (1.81125,-3.61517), (1.73746,-3.59255), (1.66302,-3.5694), (1.58516,-3.54502), (1.50423,-3.5193), (1.42052,-3.49229), (1.33432,-3.46405), (1.24596,-3.43465), (1.15416,-3.40361), (1.06096,-3.37147), (0.966646,-3.33841), (0.868249,-3.30334), (0.769674,-3.26729), (0.667828,-3.2294), (0.567923,-3.19122), (0.470726,-3.15304), (0.376268,-3.11487), (0.284578,-3.07673), (0.195682,-3.03863), (0.110796,-3.00112), (0.0285235,-2.96381), (-0.05104,-2.92654), (-0.127861,-2.88933), (-0.201909,-2.8522), (-0.271399,-2.81608), (-0.338419,-2.78039), (-0.402813,-2.74477), (-0.464539,-2.70924), (-0.523566,-2.67383), (-0.578556,-2.63939), (-0.631798,-2.60504), (-0.681017,-2.5715), (-0.727867,-2.53853), (-0.771091,-2.50651), (-0.812031,-2.4751), (-0.849534,-2.44467), (-0.884892,-2.41485), (-0.916928,-2.38609), (-0.946109,-2.35874), (-0.972575,-2.3328), (-0.996461,-2.30825), (-1.0179,-2.28508), (-1.03703,-2.26329), (-1.05399,-2.24287), (-1.07069,-2.22153), (-1.08899,-2.19703), (-1.10601,-2.16745), (-1.12091,-2.1336), (-1.13371,-2.09623), (-1.1449,-2.05467), (-1.1537,-2.01072), (-1.1612,-1.96297), (-1.16679,-1.91309), (-1.17131,-1.86029), (-1.17466,-1.80477), (-1.17711,-1.74614), (-1.17873,-1.68487), (-1.17984,-1.62525), (-1.18074,-1.56853), (-1.18182,-1.5146), (-1.18339,-1.46361), (-1.18572,-1.4153), (-1.18919,-1.3702), (-1.19392,-1.32784), (-1.20095,-1.28644), (-1.2115,-1.24519), (-1.22473,-1.20252), (-1.24251,-1.15732), (-1.26405,-1.11038), (-1.28864,-1.06123), (-1.31605,-1.01017), (-1.34566,-0.957336), (-1.37738,-0.902227), (-1.41077,-0.845214), (-1.44284,-0.790698), (-1.47326,-0.738604), (-1.50177,-0.68892), (-1.52829,-0.641492), (-1.55271,-0.596195), (-1.5749,-0.552925), (-1.59486,-0.511359), (-1.61203,-0.471997), (-1.62679,-0.434711), (-1.63858,-0.399673), (-1.64851,-0.363919), (-1.65607,-0.324411), (-1.65956,-0.282362), (-1.66277,-0.239784), (-1.66377,-0.193114), (-1.66289,-0.143062), (-1.6602,-0.0898655), (-1.65571,-0.0339242), (-1.6495,0.0246799), (-1.64205,0.0804822), (-1.63348,0.133577), (-1.62394,0.183631), (-1.61364,0.230939), (-1.60253,0.275398), (-1.59086,0.316615), (-1.57894,0.354569), (-1.56657,0.389951), (-1.55372,0.422086), (-1.54074,0.451333), (-1.52769,0.477281), (-1.51461,0.500715), (-1.49946,0.524163), (-1.48131,0.548908), (-1.45944,0.574819), (-1.43411,0.599101), (-1.40425,0.623428), (-1.371,0.648861), (-1.33418,0.67482), (-1.29392,0.701069), (-1.25037,0.727427), (-1.20366,0.753751), (-1.1539,0.779927), (-1.10121,0.805861), (-1.0457,0.831475), (-0.985574,0.857529), (-0.922819,0.882256), (-0.85767,0.906442), (-0.788248,0.930749), (-0.716593,0.953671), (-0.64198,0.976217), (-0.563263,0.998332), (-0.480494,1.0196), (-0.396338,1.03935), (-0.30856,1.05881), (-0.217152,1.07727), (-0.122315,1.09466), (-0.0242571,1.11092), (0.0768066,1.12599), (0.180651,1.1398), (0.287039,1.1523), (0.39733,1.1636), (0.506115,1.17282), (0.611316,1.1802), (0.713251,1.18586), (0.812167,1.18991), (0.908257,1.19242), (1.00167,1.19345), (1.0925,1.19305), (1.18083,1.19126), (1.26671,1.18809), (1.35014,1.18357), (1.43004,1.17778), (1.50762,1.17094), (1.58284,1.16278), (1.65373,1.15353), (1.72236,1.14353), (1.78872,1.1322), (1.8509,1.11986), (1.91088,1.10677), (1.96682,1.09271), (2.02318,1.07719), (2.08066,1.05899), (2.01942,1.08023), (1.95621,1.10484), (1.8923,1.13631), (1.83085,1.17334), (1.76843,1.21558), (1.70597,1.26379), (1.64526,1.31596), (1.58366,1.37251), (1.52334,1.43242), (1.46128,1.49715), (1.40063,1.5648), (1.33895,1.63611), (1.2767,1.71131), (1.21522,1.78836), (1.15262,1.86858), (1.08921,1.95204), (1.02646,2.03646), (0.965313,2.12013), (0.906275,2.20213), (0.850209,2.28063), (0.795403,2.35755), (0.741789,2.4329), (0.690334,2.50502), (0.640779,2.5741), (0.591904,2.64171), (0.544594,2.70631), (0.498295,2.76869), (0.45333,2.82815), (0.409654,2.8848), (0.367172,2.93865), (0.324956,2.99079), (0.283593,3.03981), (0.243247,3.08591), (0.203856,3.12907), (0.161872,3.1729), (0.116867,3.2173), (0.0693446,3.2612), (0.0184231,3.30535), (-0.0385353,3.34614), (-0.100253,3.38632), (-0.167161,3.42552), (-0.237135,3.46322), (-0.311141,3.50112), (-0.389303,3.53897), (-0.469671,3.57623), (-0.552811,3.61386), (-0.639549,3.65229), (-0.727148,3.69048), (-0.812857,3.72765), (-0.896787,3.76403), (-0.977173,3.79913), (-1.05426,3.83317), (-1.12991,3.8671), (-1.20232,3.90045), (-1.27094,3.93286), (-1.33673,3.96472), (-1.39969,3.99625), (-1.45984,4.02756), (-1.51719,4.05872), (-1.57173,4.08985), (-1.62221,4.12029), (-1.6701,4.15033), (-1.7141,4.17985), (-1.75549,4.20898), (-1.79307,4.23768), (-1.82808,4.26604), (-1.85971,4.2944), (-1.88761,4.32189), (-1.91212,4.34817), (-1.93354,4.37339), (-1.95244,4.39813), (-1.96932,4.42306), (-1.98446,4.4488), (-1.99784,4.47568), (-2.0081,4.50095), (-2.01579,4.52555), (-2.02135,4.55114), (-2.02463,4.5784), (-2.02526,4.60762), (-2.0228,4.63903), (-2.01676,4.67259), (-2.00719,4.70633), (-1.99435,4.74216), (-1.97547,4.77936), (-1.95055,4.81615), (-1.91774,4.85349), (-1.87942,4.88739), (-1.83481,4.91782), (-1.78289,4.94438), (-1.7259,4.9658), (-1.66465,4.9832), (-1.59954,4.99694), (-1.53079,5.00734), (-1.46027,5.01447), (-1.38674,5.0194), (-1.30947,5.02196), (-1.23244,5.02195), (-1.15868,5.02023), (-1.08775,5.01709), (-1.01927,5.01276), (-0.954322,5.00752), (-0.892426,5.0018), (-0.833314,4.9957), (-0.777349,4.98934), (-0.724799,4.98295), (-0.675396,4.97665), (-0.627936,4.97033), (-0.583412,4.96401), (-0.5425,4.95799), (-0.504093,4.95226), (-0.468988,4.94684), (-0.436206,4.94172), (-0.406488,4.93693), (-0.379683,4.93255), (-0.355699,4.92859), (-0.334468,4.92504), (-0.315948,4.9219), (-0.300118,4.91918), (-0.287313,4.91696), (-0.277148,4.9152), (-0.269886,4.91392), (-0.265446,4.91314), (-0.263678,4.91283), (-0.263678,4.91283)]
    
    animate_coordinates(coords1, coords2)